(()=>{"use strict";const e="http://127.0.0.1:3000",t=e=>Object.keys(e).length?`?${Object.entries(e).map((e=>`${e[0]}=${e[1]}`)).join("&")}`:"";async function n(n){const a=await fetch(`${e}/garage${n?t(n):""}`);return await a.json()}async function a(t){const n=await fetch(`${e}/garage/${t}`);return await n.json()}async function c(){return(await n()).length}async function r(t){const n=await fetch(`${e}/garage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await n.json()}async function o(t,n){const a=await fetch(`${e}/engine?id=${t}&status=${n}`,{method:"PATCH"});return await a.json()}function s(e){const t=document.querySelector(`.garage-list__element[data-id="${e}"]`),n=document.createElement("div");n.className="control-car",t.append(n);const a=document.createElement("button");a.className="button-race button-start-race",a.innerHTML="Start Car",a.setAttribute("data-id",`${e}`),n.append(a);const c=document.createElement("button");c.className="button-race button-reset",c.innerHTML="Reset Car",c.disabled=!0,c.setAttribute("data-id",`${e}`),n.append(c);const r=document.createElement("button");r.className="button-car button-edit",r.innerHTML="Edit Car",r.setAttribute("data-id",`${e}`),n.append(r);const o=document.createElement("button");o.className="button-car button-delete",o.innerHTML="Delete Car",o.setAttribute("data-id",`${e}`),n.append(o),document.querySelectorAll(".button-delete").forEach((e=>{e.addEventListener("click",E)})),document.querySelectorAll(".button-edit").forEach((e=>{e.addEventListener("click",L)})),document.querySelector(".button-car__update").addEventListener("click",v),function(e){document.querySelector(`.button-start-race[data-id="${e}"]`).addEventListener("click",(()=>{$(e)}))}(e),function(e){document.querySelector(`.button-reset[data-id="${e}"]`).addEventListener("click",(()=>{H(e)}))}(e)}async function i(e){const t=document.querySelector(`.garage-list__element[data-id="${e.id}"]`),n=document.createElement("h3");n.className="name-car",n.innerHTML=e.name,t.append(n);const a=document.createElement("div");a.className="trace-car",t.append(a);const c=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=document.createElementNS("http://www.w3.org/2000/svg","use");c.classList.add("svg-car"),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","assets/svg/car.svg#Capa_1"),r.style.fill=`${e.color}`,r.setAttribute("data-id",`${e.id}`),c.append(r),a.append(c);const o=document.createElement("img");o.className="flag",o.src="assets/img/flag.png",a.append(o)}async function l(e){const t=await n(),a=document.querySelectorAll(".garage-list__element"),c=a[e].firstChild.childNodes,r=a[e].childNodes[1],o=a[e].childNodes[2].firstChild.firstChild;o.style.fill=t[e].color,o.setAttribute("data-id",`${t[e].id}`),c.forEach((n=>{n.setAttribute("data-id",`${t[e].id}`)})),r.innerHTML=t[e].name,a[e].setAttribute("data-id",`${t[e].id}`)}async function d(){const e=await c();document.querySelector(".title").innerHTML=`${e} cars in the garage`;const t=document.querySelector(".next");e>7?!0===t.disabled&&(t.disabled=!1):!1===t.disabled&&(t.disabled=!0)}async function u(e,t){if(await d(),document.querySelectorAll(".garage-list__element").length<7){const n=document.querySelector(".garage-list"),a=document.createElement("li");a.className="garage-list__element",a.setAttribute("data-id",`${e}`),n.append(a),s(e),i(t)}}async function m(n){const a=await fetch(`${e}/winners${n?t(n):""}`);return await a.json()}async function p(){return(await m()).length}async function g(e,t){const n=document.querySelector(".table-winners"),a=document.createElement("tr");a.className="tr-winner",n.append(a);const c=document.createElement("td");c.className="td-cell id-cell",c.innerHTML=`${e.id}`,a.append(c);const r=document.createElement("td");r.className="td-cell car-cell";const o=document.createElementNS("http://www.w3.org/2000/svg","svg"),s=document.createElementNS("http://www.w3.org/2000/svg","use");o.classList.add("svg-car__wins"),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","assets/svg/car-wins.svg#Capa_1"),s.style.fill=`${t.color}`,s.setAttribute("data-id",`${e.id}`),o.append(s),r.append(o),a.append(r);const i=document.createElement("td");i.className="td-cell name-cell",i.innerHTML=t.name,a.append(i);const l=document.createElement("td");l.className="td-cell wins-cell",l.innerHTML=`${e.wins}`,a.append(l);const d=document.createElement("td");d.className="td-cell time-cell",d.innerHTML=`${e.time}`,a.append(d)}async function y(e){const t=await m(e),n=document.querySelectorAll(".tr-winner");let c=0;c=t.length-1<n.length-1?t.length:n.length;for(let e=0;e<c;e++){const c=n[e].querySelector(".id-cell"),r=n[e].querySelector(".svg-car__wins").firstChild,o=n[e].querySelector(".name-cell"),s=n[e].querySelector(".wins-cell"),i=n[e].querySelector(".time-cell"),l=await a(t[e].id);c.innerHTML=t[e].id,o.innerHTML=l.name,r.style.fill=l.color,s.innerHTML=t[e].wins,i.innerHTML=t[e].time}if(t.length-1<n.length-1)for(let e=t.length;e<n.length;e++)n[e].remove();if(t.length-1>n.length-1)for(let e=n.length;e<t.length;e++){const n=await a(t[e].id);await g(t[e],n)}}function _(){const e=document.querySelector(".wins-column"),t=document.querySelector(".time-column"),n=document.querySelector(".number-page__winners").innerHTML;let a="id",c="ASC";return"Wins ↓"===e.innerHTML?(a="wins",c="ASC"):"Wins ↑"===e.innerHTML&&(a="wins",c="DESC"),"Time ↓"===t.innerHTML?(a="time",c="ASC"):"Time ↑"===t.innerHTML&&(a="time",c="DESC"),{_page:n,_limit:"10",_sort:a,_order:c}}async function b(){await async function(){const e=await p();document.querySelector(".title-winners").innerHTML=`${e} winning cars`;const t=document.querySelector(".next__winers"),n=document.querySelector(".number-page__winners"),a=Number(n.innerHTML),c=Math.ceil(e/10);e>10?!0===t.disabled&&a<c&&(t.disabled=!1):!1===t.disabled&&(t.disabled=!0)}();const e=_();await y(e)}async function w(e){const t=document.querySelector(".number-page__winners");let n=t.innerHTML;const a=document.querySelector(".next__winers"),c=document.querySelector(".prev__winers"),r=await p(),o=Math.ceil(r/10);r>10&&(e.target.classList.contains("next__winers")&&Number(n)<o&&(n=`${Number(n)+1}`,Number(n)===o&&(a.disabled=!0),c.disabled=!1),e.target.classList.contains("prev__winers")&&Number(n)>1&&(n=""+(Number(n)-1),1===Number(n)&&(c.disabled=!0),a.disabled=!1),t.innerHTML=n,b())}async function h(){const e=_(),t=document.querySelector(".wins-column"),n=document.querySelector(".time-column");"wins"===e._sort&&"Wins ↓"===t.innerHTML?(t.innerHTML="Wins ↑",e._sort="wins",e._order="DESC"):"id"!==e._sort&&"time"!==e._sort&&"Wins ↑"!==t.innerHTML||(t.innerHTML="Wins ↓",e._sort="wins",e._order="ASC"),n.innerHTML="Time",await y(e)}async function f(){const e=_(),t=document.querySelector(".wins-column"),n=document.querySelector(".time-column");"time"===e._sort&&"Time ↓"===n.innerHTML?(n.innerHTML="Time ↑",e._sort="time",e._order="DESC"):"id"!==e._sort&&"wins"!==e._sort&&"Time ↑"!==n.innerHTML||(n.innerHTML="Time ↓",e._sort="time",e._order="ASC"),t.innerHTML="Wins",await y(e)}function N(e){const t=e.toString(16);return 1==t.length?`0${t}`:t}async function S(){const e=document.querySelector(".name-car__create"),t=document.querySelector(".color-car__create");if(!e.value)throw new Error('Field "name" is empty');{const n={name:e.value,color:t.value},a=await r(n);a&&u(a.id,a)}}async function E(t){const a=t.target.getAttribute("data-id"),c=Number(a),r=await n();let o=0;for(let e=0;e<r.length;e++)r[e].id===c&&(o=e);await async function(t){const n=await fetch(`${e}/garage/${t}`,{method:"DELETE"});return await n.json()}(c),async function(e,t){const a=(await n()).length-1;await d();const c=document.querySelectorAll(".garage-list__element"),r=c.length-1,o=document.querySelector(`.garage-list__element[data-id="${e}"]`);let s=t,i=r;if(s<a)for(let e=0;e<=r;e++)c[e]===o&&(i=e),e>=i&&(s<=a?(await l(s),s++):c[e].remove());else o.remove()}(c,o)}function L(e){const t=e.target.getAttribute("data-id"),n=document.querySelectorAll(".button-edit");for(let e=0;e<n.length;e++)n[e].classList.contains("update-car")&&n[e].classList.remove("update-car");e.target.classList.add("update-car");const a=document.querySelector(`.garage-list__element[data-id="${t}"]`),c=a.childNodes[1].innerHTML,r=a.childNodes[2].firstChild.firstChild.style.fill,o=document.querySelector(".name-car__update"),s=document.querySelector(".color-car__update"),i=document.querySelector(".button-car__update");o.disabled=!1,s.disabled=!1,i.disabled=!1,o.value=c,s.value=function(e){const t=e.replace(/[^0-9, ]/g,"").split(", ");return`#${N(Number(t[0]))}${N(Number(t[1]))}${N(Number(t[2]))}`}(r)}function v(){const t=document.querySelector(".update-car").getAttribute("data-id");!async function(t){const n=document.querySelector(".name-car__update"),a=document.querySelector(".color-car__update"),c={name:n.value,color:a.value},r=await async function(t,n){const a=await fetch(`${e}/garage/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return await a.json()}(t,c);r&&async function(e,t){const n=document.querySelector(`.garage-list__element[data-id="${e}"]`),a=n.childNodes[1];n.childNodes[2].firstChild.firstChild.style.fill=t.color,a.innerHTML=t.name;const c=document.querySelector(".name-car__update"),r=document.querySelector(".color-car__update"),o=document.querySelector(".button-car__update");c.disabled=!0,r.disabled=!0,o.disabled=!0}(t,r)}(Number(t))}async function q(e){const t=document.querySelector(".number-page");let a=t.innerHTML;const r=document.querySelector(".next"),o=document.querySelector(".prev"),s=await c(),i=Math.ceil(s/7);s>7&&(e.target.classList.contains("next")&&Number(a)<i&&(a=`${Number(a)+1}`,Number(a)===i&&(r.disabled=!0),o.disabled=!1),e.target.classList.contains("prev")&&Number(a)>1&&(a=""+(Number(a)-1),1===Number(a)&&(o.disabled=!0),r.disabled=!1),t.innerHTML=a,async function(e){const t=await n(e),a=document.querySelectorAll(".garage-list__element");let c=0;c=t.length-1<a.length-1?t.length:a.length;for(let e=0;e<c;e++){const n=a[e].firstChild.childNodes,c=a[e].childNodes[1],r=a[e].childNodes[2].firstChild.firstChild;r.style.fill=t[e].color,r.setAttribute("data-id",`${t[e].id}`),n.forEach((n=>{n.setAttribute("data-id",`${t[e].id}`)})),c.innerHTML=t[e].name,a[e].setAttribute("data-id",`${t[e].id}`)}if(t.length-1<a.length-1)for(let e=t.length;e<a.length;e++)a[e].remove();if(t.length-1>a.length-1)for(let e=a.length;e<t.length;e++)await u(t[e].id,t[e]);document.querySelector(".reset-race__all").disabled||await C()}({_page:a,_limit:"7"}))}async function T(){const e=["AUDI","BENTLEY","BMW","CITROEN","FERRARI","FORD","LAMBORGHINI","NISSAN","MITSUBISHI","LEXUS"],t=["100","Defender","5","М5","Arnage","Cygnet","Arcadia","Leading","MPV","Florida"];for(let n=0;n<100;n++){const n=Math.floor(10*Math.random()),a=Math.floor(10*Math.random()),c=`#${(Math.random().toString(16)+"000000").substring(2,8).toUpperCase()}`,o={name:`${e[n]} ${t[a]}`,color:c},s=await r(o);s&&u(s.id,s)}}function M(){let e=Math.floor(80*Math.random());return Number(document.querySelector(".garage-list__element").offsetWidth)/100*e-155<0&&(e=M()),e}async function $(e){const t=await o(e,"started"),n=t.distance/t.velocity/2e3,a=document.querySelector(`.garage-list__element[data-id="${e}"]`);document.querySelector(`.button-start-race[data-id="${e}"]`).disabled=!0,document.querySelector(`.button-reset[data-id="${e}"]`).disabled=!1;const c=a.childNodes[2].firstChild;c.style.transition=`${n}s`;try{if(await o(e,"drive"))return c.style.marginLeft="calc(95% - 155px)",n}catch(e){const t=M();c.style.marginLeft=`calc(${t}% - 155px)`}}async function H(e){await o(e,"stopped");const t=document.querySelector(`.garage-list__element[data-id="${e}"]`);document.querySelector(`.button-start-race[data-id="${e}"]`).disabled=!1,document.querySelector(`.button-reset[data-id="${e}"]`).disabled=!0;const n=t.childNodes[2].firstChild;n.style.transition="0s",n.style.marginLeft="0"}async function A(){const t=document.querySelectorAll(".garage-list__element");document.querySelector(".reset-race__all").disabled=!1,document.querySelector(".start-race__all").disabled=!0;const n=[];t.forEach((e=>{n.push(Number(e.getAttribute("data-id")))}));const a=(await Promise.all(n.map((e=>$(e))))).map((e=>null==e||null==e?99:e)),c=Math.min.apply(null,a);let r=0;for(let e=0;e<a.length;e++)a[e]===c&&(r=n[e]);!async function(t,n){const a=n.toFixed(2),c=document.querySelector(`.garage-list__element[data-id="${t}"]`).childNodes[1].innerHTML;document.querySelector(".winner").innerHTML=`WINNER ${c} time: ${a}`,await async function(t,n){const a=await async function(t){const n=await fetch(`${e}/winners/${t}`);return await n.json()}(t);if(0!==Object.keys(a).length){const c={wins:Number(a.wins)+1,time:a.time<n?a.time:n};await async function(t,n){const a=await fetch(`${e}/winners/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return await a.json()}(t,c)}else{const a={id:t,wins:1,time:n};await async function(t){const n=await fetch(`${e}/winners`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await n.json()}(a)}}(t,Number(a)),b()}(r,c)}async function C(){const e=document.querySelectorAll(".garage-list__element");document.querySelector(".reset-race__all").disabled=!0,document.querySelector(".start-race__all").disabled=!1;const t=[];e.forEach((e=>{t.push(Number(e.getAttribute("data-id")))})),await Promise.all(t.map((e=>H(e))))}async function k(){const e=await p(),t=document.querySelector(".winners"),n=document.createElement("div");n.className="container-Winners-list",t.append(n);const a=document.createElement("h1");a.className="title-winners",a.innerHTML=`${e} winning cars`,n.append(a);const c=document.createElement("span");c.className="Winners-list__page",c.innerHTML="Page #",n.append(c);const r=document.createElement("span");r.className="Winners-list__page number-page__winners",r.innerHTML="1",n.append(r);const o=document.createElement("div");o.className="container-list-winners__page",n.append(o);const s=document.createElement("button");s.className="button-list button-list-winners prev__winers",s.innerHTML="Prev",s.value="Prev",s.disabled=!0,o.append(s);const i=document.createElement("button");i.className="button-list button-list-winners next__winers",i.innerHTML="Next",i.value="Next",e<10&&(i.disabled=!0),o.append(i),function(){const e=document.querySelector(".winners"),t=document.createElement("div");t.className="winners-container",e.append(t);const n=document.createElement("table");n.className="table-winners",t.append(n);const a=document.createElement("tr");a.className="tr-header",n.append(a);const c=document.createElement("th");c.className="th-header id-column",c.innerHTML="ID",a.append(c);const r=document.createElement("th");r.className="th-header car-column",r.innerHTML="Color",a.append(r);const o=document.createElement("th");o.className="th-header name-column",o.innerHTML="Name",a.append(o);const s=document.createElement("th");s.className="th-header wins-column",s.innerHTML="Wins",a.append(s);const i=document.createElement("th");i.className="th-header time-column",i.innerHTML="Time",a.append(i),document.querySelector(".wins-column").addEventListener("click",h),document.querySelector(".time-column").addEventListener("click",f)}(),document.querySelectorAll(".button-list-winners").forEach((e=>{e.addEventListener("click",w)}))}const x=document.body,j=document.createElement("header");j.className="container-logo",x.append(j);const P=document.createElement("img");P.className="logo",P.src="./assets/img/logo.png",P.alt="Logo Race",j.append(P);const R=document.createElement("nav");R.className="container-nav",x.append(R);const W=document.createElement("ul");W.className="navbar",R.append(W);const O=document.createElement("li");O.className="navbar__item",W.append(O);const I=document.createElement("button");I.className="button-navigation to-garage button-navigation__active",I.innerHTML="to garage",O.append(I);const D=document.createElement("li");D.className="navbar__item",W.append(D);const U=document.createElement("button");U.className="button-navigation to-winners",U.innerHTML="to winners",D.append(U);const F=document.createElement("main");F.className="main",x.append(F);const B=document.createElement("section");B.className="garage",B.style.display="block",F.append(B);const J=document.createElement("section");J.className="winners",J.style.display="none",F.append(J);const G=document.createElement("footer");G.className="footer",x.append(G);const V=document.createElement("div");V.className="footer__container",G.append(V);const X=document.createElement("span");X.className="years",X.innerHTML="@2022",V.append(X);const Y=document.createElement("a");Y.className="git-link",Y.href="https://github.com/RigelTLT",Y.innerHTML=" Github",V.append(Y);const z=document.createElement("div");z.className="footer__container",G.append(z);const K=document.createElement("a");K.className="rs-link",K.href="https://rs.school/js/",z.append(K);const Q=document.createElement("img");Q.className="rs-img",Q.src="https://rs.school/images/rs_school_js.svg",Q.alt="Rolling Scopes School",K.append(Q),async function(){const e=document.querySelector(".garage"),t=document.createElement("div");t.className="container-garage container__create-car",e.append(t);const n=document.createElement("input");n.className="input-car name-car__create",t.append(n);const a=document.createElement("input");a.className="color-car color-car__create",a.type="color",t.append(a);const c=document.createElement("button");c.className="button-car button-car__create",c.innerHTML="Create",t.append(c),document.querySelector(".button-car__create").addEventListener("click",S)}(),async function(){const e=document.querySelector(".garage"),t=document.createElement("div");t.className="container-garage container__update-car",e.append(t);const n=document.createElement("input");n.className="input-car name-car__update",n.disabled=!0,t.append(n);const a=document.createElement("input");a.className="color-car color-car__update",a.disabled=!0,a.type="color",t.append(a);const c=document.createElement("button");c.className="button-car button-car__update",c.innerHTML="Update",c.disabled=!0,t.append(c)}(),async function(){const e=document.querySelector(".garage"),t=document.createElement("div");t.className="container-garage container__generate-car",e.append(t);const n=document.createElement("button");n.className="button-car button-car__generate",n.innerHTML="Generate",t.append(n),document.querySelector(".button-car__generate").addEventListener("click",T)}(),async function(){const e=document.querySelector(".garage"),t=document.createElement("div");t.className="container-garage container__controls",e.append(t);const n=document.createElement("button");n.className="button-race start-race__all",n.innerHTML="Start Race",t.append(n);const a=document.createElement("button");a.className="button-race reset-race__all",a.innerHTML="Reset Race",a.disabled=!0,t.append(a),document.querySelector(".start-race__all").addEventListener("click",A),document.querySelector(".reset-race__all").addEventListener("click",C)}(),function(){const e=document.querySelector(".container-garage-list");e&&e.remove(),async function(){const e=await c(),t=document.querySelector(".garage"),a=document.createElement("div");a.className="container-garage-list",t.append(a);const r=document.createElement("span");r.className="winner",a.append(r);const o=document.createElement("h1");o.className="title",o.innerHTML=`${e} cars in the garage`,a.append(o);const l=document.createElement("span");l.className="garage-list__page",l.innerHTML="Page #",a.append(l);const d=document.createElement("span");d.className="garage-list__page number-page",d.innerHTML="1",a.append(d);const u=document.createElement("div");u.className="container-list__page",a.append(u);const m=document.createElement("button");m.className="button-list button-list-garage prev",m.innerHTML="Prev",m.value="Prev",m.disabled=!0,u.append(m);const p=document.createElement("button");p.className="button-list button-list-garage next",p.innerHTML="Next",p.value="Next",e<7&&(p.disabled=!0),u.append(p),document.querySelectorAll(".button-list-garage").forEach((e=>{e.addEventListener("click",q)})),async function(e){const t={_page:"1",_limit:"7"},a=await n(t),c=document.querySelector(".container-garage-list"),r=document.createElement("ul");r.className="garage-list",c.append(r),a.map((e=>{if(e){const t=document.createElement("li");t.className="garage-list__element",t.setAttribute("data-id",`${e.id}`),r.append(t),s(e.id),i(e)}}))}()}()}(),async function(){await k(),async function(e){let t={};t={_page:"1",_limit:"10",_sort:"id",_order:"ASC"};const n=await m(t),c=document.querySelector(".table-winners");for(let e=0;e<n.length;e++){const t=await a(n[e].id),r=document.createElement("tr");r.className="tr-winner",c.append(r);const o=document.createElement("td");o.className="td-cell id-cell",o.innerHTML=n[e].id,r.append(o);const s=document.createElement("td");s.className="td-cell car-cell";const i=document.createElementNS("http://www.w3.org/2000/svg","svg"),l=document.createElementNS("http://www.w3.org/2000/svg","use");i.classList.add("svg-car__wins"),l.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","assets/svg/car-wins.svg#Capa_1"),l.style.fill=`${t.color}`,l.setAttribute("data-id",`${n[e].id}`),i.append(l),s.append(i),r.append(s);const d=document.createElement("td");d.className="td-cell name-cell",d.innerHTML=t.name,r.append(d);const u=document.createElement("td");u.className="td-cell wins-cell",u.innerHTML=n[e].wins,r.append(u);const m=document.createElement("td");m.className="td-cell time-cell",m.innerHTML=n[e].time,r.append(m)}}()}(),document.querySelector(".to-garage").addEventListener("click",(function(){const e=document.querySelector(".to-winners");e.classList.contains("button-navigation__active")&&e.classList.remove("button-navigation__active");const t=document.querySelector(".to-garage");t.classList.contains("button-navigation__active")||t.classList.add("button-navigation__active");const n=document.querySelector(".garage");"none"===n.style.display&&(n.style.display="block");const a=document.querySelector(".winners");"block"===a.style.display&&(a.style.display="none")})),document.querySelector(".to-winners").addEventListener("click",(function(){const e=document.querySelector(".to-garage");e.classList.contains("button-navigation__active")&&e.classList.remove("button-navigation__active");const t=document.querySelector(".to-winners ");t.classList.contains("button-navigation__active")||t.classList.add("button-navigation__active");const n=document.querySelector(".winners");"none"===n.style.display&&(n.style.display="block");const a=document.querySelector(".garage");"block"===a.style.display&&(a.style.display="none")}))})();